<link rel="import" href="../element.html">

<template id="magnon-logo">
    <style>
        :host {
            display: inline-block;
            min-height: 30px;
            height: 50px;

            font-size: 0;
        }

        #icon {
            height: 100%;
            float: left;

            fill: white;
            stroke: none;

            transition: transform 0.7s ease;
            transform-origin: 50% 50%;
        }

        #icon > path {
            transition: opacity 0.9s;
        }

        #text {
            height: 100%;
            float: right;

            fill: none;
            stroke: white;
            stroke-width: 2;
        }

        #text > path {
            transition: stroke-dashoffset 0.7s;
        }
    </style>

    <svg id="icon" viewbox="0 0 50 50" aria-hidden="true">
        <path d="M36.672 13.25a13.558 13.558 0 0 0-9.714-3.903 17.777 14.18 44.67 0 1 8.695 5.23 17.777 14.18 44.67 0 1 5.016 7.729 13.558 13.558 0 0 0-3.997-9.056z" />
        <path d="M14.474 8.417a17.293 17.293 0 0 0-3.527 24.2 17.293 17.293 0 0 0 12.596 6.9 16.809 16.809 0 0 1-9.955-6.367 16.809 16.809 0 0 1 3.428-23.522 16.809 16.809 0 0 1 17.825-1.41 17.293 17.293 0 0 0-20.367.199z" />
        <path d="M10.845 39.491a19.467 19.467 0 0 0 25.893 1.112 23.869 24.847 44.226 0 1-25.871-4.64A23.869 24.847 44.226 0 1 5 26.416a19.467 19.467 0 0 0 5.845 13.075z" />
    </svg>

    <svg id="text" viewbox="0 0 130 50" role="img" aria-label="Magnon">
        <title>Magnon</title>

        <path d="M6 7.75v25" />
        <path d="M6.119 8.231l11.16 20.773h.443L28.88 8.23" />
        <path d="M29 7.745v25" />
        <path d="M48 25a6.5 6.5 0 0 1-6.5 6.5A6.5 6.5 0 0 1 35 25a6.5 6.5 0 0 1 6.5-6.5A6.5 6.5 0 0 1 48 25z" />
        <path d="M48 17.5v15" />
        <path d="M67 25a6.5 6.5 0 0 1-6.5 6.5A6.5 6.5 0 0 1 54 25a6.5 6.5 0 0 1 6.5-6.5A6.5 6.5 0 0 1 67 25z" />
        <path d="M67 17.75v17a6.25 6.25 0 0 1-12.5 0" />
        <path d="M73 17.75v15" />
        <path d="M73 25.484c0-3.731 2.91-6.756 6.5-6.756s6.5 3.025 6.5 6.756v7.266" />
        <path d="M105 25a6.5 6.5 0 0 1-6.5 6.5A6.5 6.5 0 0 1 92 25a6.5 6.5 0 0 1 6.5-6.5A6.5 6.5 0 0 1 105 25z" />
        <path d="M111 17.75v15" />
        <path d="M111 25.484c0-3.731 2.91-6.756 6.5-6.756s6.5 3.025 6.5 6.756v7.266" />
    </svg>
</template>

<script>
    /* globals MagnonElement */
    class MagnonLogo extends MagnonElement {
        constructor() {
            super();

            this._icon = this.root.querySelector("#icon");
            this._text = this.root.querySelector("#text");

            this._iconPaths = this._icon.querySelectorAll("path");
            this._textPaths = this._text.querySelectorAll("path");

            this._animating = false;
        }

        static get name() {
            return "magnon-logo";
        }

        get animating() {
            return this._animating;
        }

        connectedCallback() {
            if (this.hasAttribute("animate")) {
                this.animateIn();
            }
        }

        animateIn(callback) {
            this._animate("in", callback);
        }

        animateOut(callback) {
            this._animate("out", callback);
        }

        _animate(direction, callback) {
            this._animating = true;
            const animatingIn = direction === "in";

            /* Text Animation */
            this._textPaths.forEach((path, i) => {
                path.style.transition = "none";

                const strokeLength = path.getTotalLength();
                path.style.strokeDasharray = strokeLength;
                path.style.strokeDashoffset = animatingIn ? strokeLength : 0;

                setTimeout(() => {
                    path.style.transition = "";
                    path.style.strokeDashoffset = animatingIn ? 0 : strokeLength;

                    if (i === this._textPaths.length - 1) {
                        this._animating = false;
                        if (typeof callback === "function") {
                            path.addEventListener("transitionend", () => callback());
                        }
                    }
                }, i * 50);
            });

            /* Icon Aniamtion */
            const rotationAmount = "80deg";

            this._icon.style.transition = "none";
            this._icon.style.transform = animatingIn
                ? `rotate(${rotationAmount})` : "rotate(0)";

            setTimeout(() => {
                this._icon.style.transition = "";
                this._icon.style.transform = animatingIn
                    ? "rotate(0)" : `rotate(-${rotationAmount})`;
            }, 50);

            for (let i = 0; i < this._iconPaths.length; i++) {
                const path = this._iconPaths[
                    animatingIn ? i : -(i - this._iconPaths.length) - 1
                ];

                path.style.transition = "none";
                path.style.opacity = animatingIn ? 0 : 1;

                setTimeout(() => {
                    path.style.transition = "";
                    path.style.opacity = animatingIn ? 1 : 0;
                }, i * 200);
            }
        }
    }

    MagnonLogo.init();
</script>
