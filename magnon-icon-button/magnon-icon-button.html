<link rel="import" href="../element.html">
<link rel="import" href="../magnon-icon/magnon-icon.html">

<template id="magnon-icon-button">
    <style>
        :host {
            display: inline-block;
        }

        button {
            padding: var(--magnon-icon-button-padding, 10px);
            font-size: 0;

            border: none;
            border-radius: 50%;
            background-color: transparent;

            transition: background 0.15s ease-out;
            outline: none;
        }

        button:focus {
            background: rgba(46, 163, 111, 0.5);
        }

        button:active {
            background: rgba(46, 163, 111, 0.8);
        }

        button::-moz-focus-inner {
            padding: 0;
        }
    </style>

    <button>
        <magnon-icon></magnon-icon>
    </button>
</template>

<script>
    /* globals MagnonElement */
    class MagnonIconButton extends MagnonElement {
        static get name() {
            return "magnon-icon-button";
        }

        static get observedAttributes() {
            return ["icon", "title", "tabindex"];
        }

        constructor() {
            super();

            this._button = this.root.querySelector("button");
            this._icon = this.root.querySelector("magnon-icon");
        }

        attributeChangedCallback(attribute, old, value) {
            if (attribute === "icon") {
                this._icon.setAttribute(attribute, value);
                if (!this.hasAttribute("title")) {
                    this._setTitleFromIconName(value);
                }
            } else if (attribute === "title") {
                if (value && value.length > 0) {
                    this._button.setAttribute("aria-label", value);
                } else {
                    this._setTitleFromIconName(this.getAttribute("icon"));
                }
            } else if (attribute === "tabindex") {
                // BUG: It doesn't seem like the polyfill takes into account
                // tabindex incapsulation of shadowdom. This is a workaround.
                this._button.setAttribute("tabindex", value);
            }
        }

        _setTitleFromIconName(iconName) {
            const dashIndex = iconName.indexOf("-");
            const betterName = (
                iconName.charAt(dashIndex + 1).toUpperCase() +
                iconName.slice(dashIndex + 2)
            ).replace(/-/g, " ");
            this._button.setAttribute("aria-label", betterName);
        }
    }

    MagnonIconButton.init();
</script>
