<link rel="import" href="../element.html">
<link rel="import" href="../magnon-styles/magnon-styles.html">

<template id="magnon-drawer">
    <style>
        #container {
            display: flex;
            position: fixed;
            top: 0; bottom: 0; left: -300px;
            width: 90vw;
            height: 100vh;
            max-width: 300px;
            z-index: 10001;

            background: white;
            font-family: var(--magnon-font);

            transition: left 0.15s ease-out;
        }

        #main-nav > ::slotted(a) {
            color: var(--magnon-dark-teal);
            text-decoration: none;
            display: block;
            text-align: left;
            font-size: 20px;
            margin: 30px 30px;
            flex-grow: 1;
        }

        #blackout {
            position: fixed;
            top: 0; right: 0; bottom: 0; left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10000;

            background: var(--magnon-black-blue);
            opacity: 0;
            pointer-events: none;

            transition: opacity 0.2s ease-in-out;
        }
    </style>

    <div id="container">
        <nav id="main-nav">
            <slot name="nav"></slot>
        </nav>
    </div>

    <span id="blackout"></span>
</template>

<script>
    /* globals MagnonElement */
    class MagnonDrawer extends MagnonElement {
        static get name() {
            return "magnon-drawer";
        }

        static get propertyAttributes() {
            return {
                bool: ["open"]
            };
        }

        constructor() {
            super();

            this._open = false;

            this._container = this.root.querySelector("#container");
            this._blackout = this.root.querySelector("#blackout");
        }

        connectedCallback() {
            this._closeCallback = () => (this.open = false);
            this._blackout.addEventListener("click", this._closeCallback);
        }

        disconnectedCallback() {
            if (!this._closeCallback) return;
            this._blackout.removeEventListener("click", this._closeCallback);
        }

        propertySet(property, old, value) {
            if (property === "open") {
                this._setOpen(value);
            }
        }

        _setOpen(isOpen) {
            if (this._lastOpen === isOpen) return;
            this._lastOpen = isOpen;

            if (isOpen) {
                this._container.style.left = "0px";
                this._blackout.style.opacity = "0.8";
                this._blackout.style.pointerEvents = "all";
            } else {
                this._container.style.left = "-300px";
                this._blackout.style.opacity = "0";
                this._blackout.style.pointerEvents = "none";
            }
        }
    }

    MagnonDrawer.init();
</script>
